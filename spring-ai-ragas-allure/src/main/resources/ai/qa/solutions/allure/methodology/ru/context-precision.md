# Метрика Context Precision (Точность контекста)

## Глоссарий

- **Контекст** — фрагменты информации, найденные системой поиска и предоставленные агентной системе
- **Релевантность** — соответствие контекста исходному вопросу пользователя
- **Агентная система** — система на основе LLM, генерирующая ответы
- **Average Precision** — средняя точность, учитывающая позиции релевантных результатов

## Описание

Метрика оценивает качество ранжирования контекстов системой поиска. Проверяет, находятся ли наиболее релевантные контексты на первых позициях. Релевантные контексты в начале списка повышают скор, в конце — понижают.

## Пример

**Вопрос пользователя:** «Когда была построена Эйфелева башня?»

**Полученные контексты (по порядку):**
1. «Эйфелева башня была завершена в 1889 году для Всемирной выставки.» — **РЕЛЕВАНТНО**
2. «Её высота составляет 330 метров.» — **НЕ РЕЛЕВАНТНО** к вопросу
3. «Строительство началось в 1887 году.» — **РЕЛЕВАНТНО**

**Расчёт:**
- Позиция 1: Релевантно → Precision@1 = 1/1 = 1.00
- Позиция 2: Не релевантно → пропускаем
- Позиция 3: Релевантно → Precision@3 = 2/3 = 0.67

**Скор:** (1.00 + 0.67) / 2 = **0.83 (83%)**

## Интерпретация скора

|  Скор   |                     Значение                     |
|---------|--------------------------------------------------|
| 90-100% | Релевантные контексты на первых позициях         |
| 70-90%  | Большинство релевантных контекстов вверху списка |
| 50-70%  | Релевантные контексты распределены неравномерно  |
| 0-50%   | Релевантные контексты на последних позициях      |

## Алгоритм

1. **Проверка релевантности** — LLM определяет релевантность каждого контекста к вопросу
2. **Расчёт точности на позициях** — для каждого релевантного контекста вычисляется точность на его позиции
3. **Усреднение** — вычисляется среднее значение всех точностей

## Формула

```
score = Average Precision (AP) = Σ(precision@k × relevance@k) / total_relevant
```

Где:
- `precision@k` — доля релевантных контекстов в топ-k позициях
- `relevance@k` — 1, если контекст на позиции k релевантен, иначе 0
- `total_relevant` — общее количество релевантных контекстов

## Ссылки

- [Документация RAGAS](https://github.com/vibrantlabsai/ragas/blob/main/docs/concepts/metrics/available_metrics/context_precision.md)

