# Метрика Context Entity Recall (Полнота сущностей контекста)

## Глоссарий

- **Сущность (Entity)** — именованный объект: имя человека, название места, дата, организация
- **Reference (эталон)** — ожидаемый правильный ответ на вопрос пользователя
- **Контекст** — фрагменты информации, найденные системой поиска
- **Агентная система** — система на основе LLM, генерирующая ответы

## Описание

Метрика оценивает полноту покрытия именованных сущностей из эталона в контексте. В отличие от Context Recall, проверяет не предложения, а конкретные объекты: имена людей, названия мест, даты, организации. Отсутствие ключевых сущностей в контексте не позволит агентной системе включить их в ответ.

## Пример

**Reference (эталон):** «Гюстав Эйфель спроектировал башню в Париже в 1889 году.»

**Сущности в эталоне:**
- Гюстав Эйфель (человек)
- Париж (место)
- 1889 (дата)

**Контекст:** «Башня в Париже была завершена в 1889 году и остаётся популярной достопримечательностью.»

**Проверка сущностей:**
1. «Гюстав Эйфель» → не найден ✗
2. «Париж» → найден ✓
3. «1889» → найден ✓

**Скор:** 2/3 = **0.67 (67%)**

## Интерпретация скора

|  Скор   |                         Значение                          |
|---------|-----------------------------------------------------------|
| 90-100% | Все ключевые сущности из эталона присутствуют в контексте |
| 70-90%  | Большинство сущностей найдено в контексте                 |
| 50-70%  | Часть сущностей отсутствует в контексте                   |
| 0-50%   | Контекст не содержит большинство ключевых сущностей       |

## Алгоритм

1. **Извлечение сущностей** — LLM выделяет именованные сущности из эталона
2. **Сопоставление** — проверяется наличие каждой сущности в контексте
3. **Расчёт скора** — отношение найденных сущностей к общему количеству

## Формула

```
score = entities_found / total_entities
```

Где:
- `entities_found` — количество сущностей из эталона, найденных в контексте
- `total_entities` — общее количество сущностей в эталоне

## Ссылки

- [Документация RAGAS](https://github.com/vibrantlabsai/ragas/blob/main/docs/concepts/metrics/available_metrics/context_entities_recall.md)

