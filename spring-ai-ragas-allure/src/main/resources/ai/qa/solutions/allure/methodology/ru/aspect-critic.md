# Метрика Aspect Critic (Критик аспектов)

## Глоссарий

- **Аспект** — пользовательский критерий для оценки ответа
- **Агентная система** — система на основе LLM, генерирующая ответы
- **Strictness (строгость)** — количество итераций LLM на каждую модель для самосогласованности через majority voting

## Описание

Метрика выполняет бинарную проверку ответа агентной системы на соответствие заданному критерию. Результат оценки: соответствует (1.0) или не соответствует (0.0).

## Пример

**Критерий:** «Ответ не должен содержать вредный или оскорбительный контент»

**Ответ агентной системы:** «Эйфелева башня была построена в 1889 году в Париже, Франция.»

**Результат:** Вредный контент отсутствует → **1.0 (соответствует)**

---

**Критерий:** «Ответ должен содержать конкретную дату или год»

**Ответ агентной системы:** «Эйфелева башня находится в Париже и очень высокая.»

**Результат:** Дата отсутствует → **0.0 (не соответствует)**

## Интерпретация скора

| Скор |            Значение             |
|------|---------------------------------|
| 1.0  | Ответ соответствует критерию    |
| 0.0  | Ответ не соответствует критерию |

Метрика является бинарной — доступны только два результата.

## Алгоритм

1. **Определение критерия** — задаётся аспект для проверки
2. **Оценка с параметром Strictness** — для каждой модели LLM вызывается `strictness` раз (по умолчанию: 1)
3. **Majority Voting для каждой модели** — если strictness > 1, финальный вердикт модели определяется большинством голосов по итерациям
4. **Преобразование вердикта модели** — вердикт каждой модели преобразуется: PASS → 1.0, FAIL → 0.0
5. **Агрегация** — итоговый скор вычисляется как среднее значение скоров всех моделей

### Параметр Strictness

Параметр `strictness` включает проверку самосогласованности через множественные итерации LLM:

- **strictness = 1** (по умолчанию): Одна оценка на модель
- **strictness = 3**: Три оценки на модель, результат определяется большинством голосов
- **strictness = 5**: Пять оценок, более надёжно, но медленнее

Пример при strictness = 3 и 2 моделях:

```
Модель A: [PASS, PASS, FAIL] → большинство PASS → 1.0
Модель B: [FAIL, FAIL, PASS] → большинство FAIL → 0.0
Итоговый скор: (1.0 + 0.0) / 2 = 0.5 = 50%
```

## Типичные аспекты для проверки

- **Безвредность** — отсутствие вредного или оскорбительного контента
- **Лаконичность** — краткость и отсутствие избыточности
- **Связность** — логическая структурированность
- **Полнота** — охват всех требуемых пунктов
- **Фактологичность** — отсутствие домыслов и предположений

## Формула

### Для одной модели

```
вердикт_модели = majority_vote(итерации), если strictness > 1, иначе одиночная_оценка
скор_модели = 1.0, если вердикт_модели == PASS, иначе 0.0
```

### Агрегация по нескольким моделям

```
итоговый_скор = среднее(скоры_моделей)
```

Пример: 2 PASS + 3 FAIL = 2/5 = 0.40 = 40%

## Ссылки

- [Документация RAGAS](https://github.com/vibrantlabsai/ragas/blob/main/docs/concepts/metrics/available_metrics/general_purpose.md)

