# Метрика Response Relevancy (Релевантность ответа)

## Глоссарий

- **Релевантность** — соответствие ответа исходному вопросу пользователя
- **Эмбеддинг** — числовое векторное представление текста
- **Косинусное сходство** — мера близости двух векторов (от 0 до 1)
- **Агентная система** — система на основе LLM, генерирующая ответы

## Описание

Метрика оценивает, насколько ответ агентной системы соответствует вопросу пользователя. Для оценки из ответа генерируются гипотетические вопросы, на которые этот ответ мог бы отвечать. Затем измеряется сходство этих вопросов с оригинальным вопросом пользователя.

## Пример

**Вопрос пользователя:** «Когда была построена Эйфелева башня?»

**Ответ агентной системы:** «Эйфелева башня была завершена в 1889 году для Всемирной выставки в Париже.»

**Сгенерированные вопросы (из ответа):**
- «Когда была построена Эйфелева башня?» — совпадает с оригиналом
- «В каком году была завершена Эйфелева башня?» — близко к оригиналу
- «Зачем построили Эйфелеву башню?» — частичное совпадение

**Скор:** высокое сходство = **0.92 (92%)**

---

**Нерелевантный ответ:**

**Ответ агентной системы:** «Эйфелева башня имеет высоту 330 метров и 3 этажа.»

**Сгенерированные вопросы:**
- «Какой высоты Эйфелева башня?» — не совпадает с оригиналом
- «Сколько этажей в Эйфелевой башне?» — не совпадает

**Скор:** низкое сходство = **0.35 (35%)**

## Интерпретация скора

|  Скор   |                    Значение                    |
|---------|------------------------------------------------|
| 90-100% | Ответ напрямую отвечает на вопрос пользователя |
| 70-90%  | Ответ в основном соответствует вопросу         |
| 50-70%  | Ответ частично затрагивает вопрос              |
| 0-50%   | Ответ не соответствует вопросу                 |

## Алгоритм

1. **Генерация вопросов** — LLM создаёт вопросы, на которые мог бы отвечать данный ответ
2. **Создание эмбеддингов** — вопросы преобразуются в числовые векторы
3. **Сравнение** — вычисляется косинусное сходство между оригинальным и сгенерированными вопросами
4. **Усреднение** — вычисляется среднее значение сходства

## Формула

```
score = mean(cosine_similarity(original_question, generated_questions))
```

Где:
- `original_question` — вопрос пользователя
- `generated_questions` — гипотетические вопросы, сгенерированные из ответа
- `cosine_similarity` — мера сходства двух эмбеддингов (от 0 до 1)

## Ссылки

- [Документация RAGAS](https://github.com/vibrantlabsai/ragas/blob/main/docs/concepts/metrics/available_metrics/answer_relevance.md)

