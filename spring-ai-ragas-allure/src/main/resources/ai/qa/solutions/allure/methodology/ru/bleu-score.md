# Метрика BLEU Score

## Глоссарий

- **BLEU** — Bilingual Evaluation Understudy, метрика для оценки качества текста
- **N-грамма** — последовательность из n элементов текста (униграмма=1 слово, биграмма=2 слова)
- **Точность (Precision)** — отношение совпадающих n-грамм к общему количеству n-грамм в ответе
- **Штраф за краткость** — штраф, применяемый когда ответ короче эталона

## Описание

BLEU (Bilingual Evaluation Understudy) измеряет схожесть между текстом-кандидатом (ответом) и эталонным текстом путём вычисления точности по n-граммам. Изначально разработанная для оценки машинного перевода, метрика широко используется для оценки качества генерации текста.

Особенности метрики:
- **Без LLM** — не требует вызовов языковых моделей, чисто алгоритмический подход
- **Быстрая** — простые операции подсчёта n-грамм
- **Детерминированная** — одинаковые входные данные всегда дают одинаковый результат
- **Универсальная по языку** — работает с любым языком, который можно токенизировать

## Пример

**Эталон:** "Быстрая коричневая лиса прыгает через ленивую собаку."

**Ответ AI:** "Быстрая коричневая лиса прыгает через ленивую собаку."

**Скор:** идентичные тексты = **1.00 (100%)**

---

**Похожий ответ:**

**Ответ AI:** "Быстрая коричневая лиса прыгнула через ленивую собаку."

**Скор:** одно слово отличается = **0.85 (85%)**

---

**Разные тексты:**

**Ответ AI:** "Машинное обучение требует данных."

**Скор:** нет перекрытия = **0.05 (5%)**

## Интерпретация скора

|  Скор   |          Значение          |
|---------|----------------------------|
| 90-100% | Почти идентичные тексты    |
| 70-90%  | Высокое перекрытие n-грамм |
| 50-70%  | Умеренное перекрытие       |
| 30-50%  | Некоторые общие фразы      |
| 0-30%   | Практически нет перекрытия |

## Важные замечания

- **Порядок слов важен**: В отличие от некоторых метрик, BLEU учитывает порядок слов через n-граммы
- **Краткость штрафуется**: Короткие ответы штрафуются даже если все слова совпадают
- **Сглаживание помогает**: Для коротких текстов сглаживание предотвращает нулевые скоры
- **Не семантическая**: BLEU измеряет поверхностное перекрытие, а не смысл

## Алгоритм

1. **Токенизация** — разбиение обоих текстов на токены (слова)
2. **Вычисление точности n-грамм** — для каждого n от 1 до max_ngram подсчёт совпадающих n-грамм
3. **Применение штрафа за краткость** — если ответ короче эталона, применяется штраф
4. **Комбинирование скоров** — геометрическое среднее точностей умноженное на штраф за краткость

## Формула

```
BLEU = BP × exp(Σ wₙ × log(pₙ))
```

Где:
- `BP` — штраф за краткость = min(1, exp(1 - ref_len/resp_len))
- `pₙ` — модифицированная точность для n-грамм длины n
- `wₙ` — вес для каждой n-граммы (обычно 1/max_ngram)

## Конфигурация

| Параметр  |   Тип   | По умолчанию |                   Описание                   |
|-----------|---------|--------------|----------------------------------------------|
| maxNgram  | Integer | 4            | Максимальный порядок n-грамм (обычно 1-4)    |
| smoothing | Boolean | true         | Использовать сглаживание для нулевых n-грамм |

## Ссылки

- [Статья о BLEU (Papineni et al., 2002)](https://aclanthology.org/P02-1040.pdf)
- [BLEU Wikipedia](https://en.wikipedia.org/wiki/BLEU)

