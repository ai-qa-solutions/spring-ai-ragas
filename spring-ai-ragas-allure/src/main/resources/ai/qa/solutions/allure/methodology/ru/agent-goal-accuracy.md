# Метрика Agent Goal Accuracy

## Глоссарий

- **Агент** — система на основе ИИ, способная вести многоходовые диалоги и выполнять действия
- **Цель** — желаемый результат или задача, которую пользователь хочет достичь через взаимодействие с агентом
- **Многоходовой диалог** — диалог, состоящий из нескольких обменов репликами между пользователем и агентом

## Описание

Метрика оценивает, успешно ли AI-агент достиг поставленной цели на основе анализа многоходового диалога. Поддерживаются два режима оценки:

- **WITH_REFERENCE** — сравнение результата диалога с предоставленной ожидаемой целью
- **WITHOUT_REFERENCE** — вывод цели из диалога и оценка её достижения

## Пример

**Диалог:**

```
[ПОЛЬЗОВАТЕЛЬ]: Мне нужно забронировать билет на поезд из Москвы в Санкт-Петербург на завтра.
[АССИСТЕНТ]: Помогу вам с бронированием. Сейчас поищу доступные рейсы.
[АССИСТЕНТ]: Нашёл несколько вариантов. Лучший вариант - Сапсан в 8:00 за 4500 рублей.
[ПОЛЬЗОВАТЕЛЬ]: Отлично, забронируйте этот рейс.
[АССИСТЕНТ]: Готово! Номер бронирования: СП12345. Подтверждение отправлено на почту.
```

**Ожидаемый результат (Reference):** "Забронировать билет на поезд из Москвы в Санкт-Петербург"

**Анализ:**
- Пользователь запросил бронирование билета
- Агент нашёл доступные рейсы
- Агент успешно завершил бронирование с номером подтверждения

**Оценка:** **1.0 (100%)** — Цель достигнута

## Интерпретация оценки

|   Оценка   |                                     Значение                                      |
|------------|-----------------------------------------------------------------------------------|
| 1.0 (100%) | Цель полностью достигнута — агент успешно выполнил поставленную задачу            |
| 0.0 (0%)   | Цель не достигнута — агент не смог выполнить задачу или выполнил её лишь частично |

## Алгоритм

### Режим WITH_REFERENCE

1. **Сравнение результата** — LLM сравнивает результат диалога с предоставленной ожидаемой целью
2. **Бинарный вердикт** — определяется, достигнута цель (1.0) или нет (0.0)

### Режим WITHOUT_REFERENCE

1. **Вывод цели** — LLM анализирует диалог для определения основной задачи пользователя
2. **Оценка результата** — LLM оценивает, достигли ли действия агента выведенной цели
3. **Бинарный вердикт** — определяется, достигнута цель (1.0) или нет (0.0)

## Формула

```
score = goalAchieved ? 1.0 : 0.0
```

Где:
- `goalAchieved` — булево значение, указывающее, была ли полностью достигнута поставленная цель

## Конфигурация

```java
AgentGoalAccuracyConfig config = AgentGoalAccuracyConfig.builder()
    .mode(Mode.WITH_REFERENCE)  // или Mode.WITHOUT_REFERENCE
    .build();
```

| Параметр |      Тип       |   По умолчанию   |                      Описание                      |
|----------|----------------|------------------|----------------------------------------------------|
| `mode`   | `Mode`         | `WITH_REFERENCE` | Режим оценки: WITH_REFERENCE или WITHOUT_REFERENCE |
| `models` | `List<String>` | из executor      | Модели LLM для оценки                              |

## Требования к Sample

|    Поле     | Обязательно |                            Описание                            |
|-------------|-------------|----------------------------------------------------------------|
| `messages`  | Да          | Список сообщений диалога с ролью и содержимым                  |
| `reference` | Нет*        | Ожидаемая цель/результат (требуется для режима WITH_REFERENCE) |

*Если `reference` не предоставлен в режиме WITH_REFERENCE, метрика переключается на режим WITHOUT_REFERENCE.

## Случаи использования

- Оценка целеориентированных диалоговых систем
- Измерение показателя успешности агентов поддержки клиентов
- Оценка завершения многоэтапных рабочих процессов
- Тестирование разговорных AI-ассистентов

## Ссылки

- [Документация RAGAS](https://docs.ragas.io/)
- [Agent Goal Accuracy в Python RAGAS](https://docs.ragas.io/en/latest/concepts/metrics/agent_goal_accuracy.html)

