# Метрика chrF Score

## Глоссарий

- **chrF** — Character n-gram F-score (F-мера по символьным n-граммам)
- **chrF++** — chrF с дополнительными словесными n-граммами
- **Символьная n-грамма** — последовательность из n символов
- **Словесная n-грамма** — последовательность из n слов
- **Beta** — параметр веса, отдающий предпочтение полноте над точностью

## Описание

chrF (Character n-gram F-score) измеряет схожесть текстов на уровне символов, вычисляя F-меру по символьным n-граммам. chrF++ расширяет это, также включая словесные n-граммы. Метрики на уровне символов особенно полезны для:

- **Морфологически богатых языков** — захватывает частичные совпадения слов
- **Языков без чётких границ слов** — китайский, японский, тайский
- **Обнаружения опечаток** — небольшие вариации написания всё ещё дают хороший скор
- **Оценки переводов** — устойчива к морфологическим вариациям

Особенности метрики:
- **Без LLM** — не требует вызовов языковых моделей
- **Устойчива к опечаткам** — частичные совпадения символов учитываются в скоре
- **Гибкость по языкам** — хорошо работает даже без токенизации
- **Детерминированная** — одинаковые входные данные всегда дают одинаковый результат

## Пример

**Эталон:** "Быстрая коричневая лиса прыгает через ленивую собаку."

**Ответ AI:** "Быстрая коричневая лиса прыгает через ленивую собаку."

**chrF Скор:** идентичные тексты = **1.00 (100%)**

---

**Морфологические вариации:**

**Эталон:** "организация предприятие учреждение"

**Ответ AI:** "организации предприятия учреждения"

**chrF Скор:** высокое перекрытие символов несмотря на разные формы = **0.85 (85%)**

---

**Распространённые опечатки:**

**Эталон:** "агентство аккомодация коммуникация"

**Ответ AI:** "агенство аккомодация коммуникация"

**chrF Скор:** устойчива к опечаткам = **0.90 (90%)**

## Интерпретация скора

|  Скор   |                Значение                |
|---------|----------------------------------------|
| 90-100% | Почти идентичны на уровне символов     |
| 70-90%  | Высокое перекрытие символов            |
| 50-70%  | Умеренное перекрытие                   |
| 30-50%  | Некоторые последовательности совпадают |
| 0-30%   | Низкое сходство на уровне символов     |

## Важные замечания

- **Гранулярность на уровне символов**: Даже частичные совпадения слов учитываются в скоре
- **Beta=2 по умолчанию**: Полнота взвешивается вдвое важнее точности
- **chrF++ рекомендуется**: Включение словесных n-грамм обычно улучшает корреляцию с человеческими оценками
- **Токенизация не нужна**: Работает напрямую с последовательностями символов

## Алгоритм

1. **Извлечение символьных N-грамм** — для n от 1 до charNgramOrder извлечь все символьные n-граммы
2. **Извлечение словесных N-грамм (chrF++)** — если wordNgramOrder > 0, также извлечь словесные n-граммы
3. **Подсчёт совпадений** — подсчёт перекрывающихся n-грамм между ответом и эталоном
4. **Вычисление точности и полноты** — для каждого порядка n-грамм
5. **Комбинирование с F-мерой** — используя параметр beta для взвешивания полноты

## Формула

```
chrF_β = (1 + β²) × (P × R) / (β² × P + R)
```

Где:
- `P` — средняя точность по всем порядкам символьных (и словесных) n-грамм
- `R` — средняя полнота по всем порядкам символьных (и словесных) n-грамм
- `β` — параметр веса (по умолчанию 2.0, отдаёт предпочтение полноте)

## Конфигурация

|    Параметр    |   Тип   | По умолчанию |                      Описание                       |
|----------------|---------|--------------|-----------------------------------------------------|
| charNgramOrder | Integer | 6            | Максимальный порядок символьных n-грамм             |
| wordNgramOrder | Integer | 0            | Порядок словесных n-грамм (0=chrF, >0=chrF++)       |
| beta           | Double  | 2.0          | Параметр beta F-меры (выше = больше вес на полноту) |

## Ссылки

- [Статья о chrF (Popović, 2015)](https://aclanthology.org/W15-3049.pdf)
- [Статья о chrF++ (Popović, 2017)](https://aclanthology.org/W17-4770.pdf)

