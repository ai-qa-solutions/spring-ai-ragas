# Метрика Answer Accuracy (Точность ответа)

## Обзор

Answer Accuracy — это метрика оценки в стиле NVIDIA, которая измеряет, насколько точно ответ AI соответствует эталонному (правильному) ответу. Используется шкала оценки 0-2, которая нормализуется к 0-1 для согласованности с другими метриками.

## Как это работает

### Шкала оценки

| Оценка |     Уровень     |                             Описание                              |
|--------|-----------------|-------------------------------------------------------------------|
| 0      | Неверно         | Ответ фактически неправильный или противоречит эталону            |
| 1      | Частично верно  | Ответ частично правильный, но неполный или содержит мелкие ошибки |
| 2      | Полностью верно | Ответ точно соответствует эталонному ответу                       |

### Алгоритм

1. **Первичная оценка**: LLM оценивает ответ относительно эталона, присваивая оценку (0-2) с обоснованием
2. **Подтверждающая оценка** (опционально): При включённом режиме двойного судьи вторая оценка подтверждает или корректирует первичную
3. **Нормализация оценки**: Сырая оценка (0-2) делится на 2 для получения нормализованной оценки 0-1

### Формула

```
нормализованная_оценка = сырая_оценка / 2
```

Где:
- `сырая_оценка` — оценка LLM (0, 1 или 2)
- `нормализованная_оценка` — итоговое значение метрики (от 0.0 до 1.0)

## Интерпретация

| Диапазон |      Уровень      |                Значение                |
|----------|-------------------|----------------------------------------|
| 90-100%  | Отлично           | Ответ точно соответствует эталону      |
| 70-89%   | Хорошо            | Ответ в основном соответствует эталону |
| 50-69%   | Удовлетворительно | Ответ частично соответствует эталону   |
| 0-49%    | Плохо             | Ответ неточен или противоречит эталону |

## Параметры конфигурации

|    Параметр    |     Тип      | По умолчанию |                          Описание                          |
|----------------|--------------|--------------|------------------------------------------------------------|
| `useDualJudge` | boolean      | false        | Включить режим двойного судьи для повышения надёжности     |
| `temperature`  | double       | 0.1          | Температура LLM (ниже = более детерминированный результат) |
| `models`       | List<String> | -            | Конкретные модели для использования (опционально)          |

## Пример использования

```java
Sample sample = Sample.builder()
    .response("Москва — столица России.")
    .reference("Москва является столицей Российской Федерации.")
    .build();

AnswerAccuracyConfig config = AnswerAccuracyConfig.builder()
    .useDualJudge(false)
    .temperature(0.1)
    .build();

Double score = answerAccuracyMetric.singleTurnScore(config, sample);
```

## Режим двойного судьи

При включённом `useDualJudge`:

1. Первый LLM оценивает ответ относительно эталона
2. Второй LLM проверяет первичную оценку
3. Используется подтверждающая оценка, если доступна
4. При сбое подтверждения используется первичная оценка

Этот режим повышает надёжность, но увеличивает задержку и стоимость.

## Обязательные поля Sample

- `response` — ответ AI для оценки
- `reference` — эталонный/ожидаемый ответ

## Сравнение с другими метриками

|       Метрика       |        Назначение        |         Метод          |
|---------------------|--------------------------|------------------------|
| **Answer Accuracy** | Соответствие эталону     | Оценка LLM (шкала 0-2) |
| Semantic Similarity | Схожесть по эмбеддингам  | Косинусное сходство    |
| Factual Correctness | Декомпозиция утверждений | NLI-верификация        |

## Лучшие практики

1. **Чёткие эталоны**: Предоставляйте ясные, однозначные эталонные ответы
2. **Двойной судья для критичных**: Используйте режим двойного судьи для важных оценок
3. **Согласованный формат**: Поддерживайте похожий формат ответа и эталона
4. **Несколько моделей**: Используйте несколько моделей-судей для консенсуса

## Ограничения

- Оценка на основе LLM может иметь предубеждения
- Чувствительность к различиям в формулировках между ответом и эталоном
- Может не улавливать нюансы корректности в сложных областях
- Субъективная интерпретация «частично правильного» ответа

